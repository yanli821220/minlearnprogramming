---
layout: page
include_in_header: false
permalink: /_booklets/106339785/
---
在阿里云海外windows主机上开启VPN
=====

阿里云ECS比较特殊，因为它是双网卡的，且其DNS走的却是内网卡，这就造成了一般的windows VPN搭建方案在阿里云ecs windows上不能用的情形，比如：

按网上的教程，第一步你允许外网卡出网了。但是此时你只能连上VPN但不能连外网，这是问题之一。因为DNS依赖的内网卡不能出网。

解决方法是，内外网连接全部出网并启用NAT，放行其访问公网就可以。。



第二，由于VPN走的NAT，开启VPN必须要开启NAT。在开启nat后，，VPN的确能连上外网，但仅限系统第一次开启后有效且一会就没了，运气坏的话一次也连不上，表现为这个时候你还会发现服务器在第一次重启15分钟后就会断掉你包括VPN远程桌面，PING的所有连接。

这是因为简单防火墙把你外网卡走NAT的所有对外端口都屏蔽了，，不止VPN的那些，其它都会断掉。所以此时离正常搭建VPN还是有问题的，这就需要NAT下开启相应服务端口。

解决方法是：这个时候在每个连接的NAT里服务简单防火墙那一栏开启相应的服务，包括远程桌面，WEB，PPTP，L2TP等等。。。其中L2TP是VPN用的，其它的，比如你想远程连接就开放3389（比如在开放了VPN的云主机上，远程桌面往往诡异地无法连接，此时你就需要想到是简单防火墙没给这个走NAT的3389放行）

所以配置路由和网关时应该这样进行：



只有在二张中的所有设置完成之后，你才能正常连上VPN，linux一键脚本修改原理如上。



-----


(此处不设回复，扫码到微信参与留言，或直接点击到原文)

![](/p/106339785/qrcode.png)

<!-- Markdeep: -->
<meta charset="utf-8">
<link rel="stylesheet" href="../../res/aloha.css?">

<script src="../../res/markdeep.min.js" charset="utf-8"></script>





